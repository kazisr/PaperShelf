<div class="group bg-white rounded-2xl shadow-xl hover:shadow-2xl transition-shadow duration-300 overflow-hidden flex flex-col h-full border border-gray-100">
  <div class="relative h-48 bg-gray-50 flex items-center justify-center overflow-hidden">
    {% if p.thumb_path %}
  <img src="/media/{{ p.thumb_path }}" alt="Thumbnail for {{ p.title }}"
       class="thumb-img w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.05]" />
{% else %}
  <svg class="w-full h-full text-gray-300" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="No thumbnail">
    <defs>
      <linearGradient id="g-modern" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="currentColor" stop-opacity="0.3"/>
        <stop offset="100%" stop-color="currentColor" stop-opacity="0.1"/>
      </linearGradient>
    </defs>
    <rect width="400" height="300" fill="url(#g-modern)"/>
    <g fill="currentColor" opacity="0.6">
      <rect x="50" y="50" width="300" height="150" rx="10" ry="10" fill="currentColor" opacity="0.15"/>
      <circle cx="200" cy="150" r="50" fill="currentColor" opacity="0.1"/>
      <path d="M200 120 L250 180 L150 180 Z" fill="currentColor" opacity="0.2"/>
    </g>
  </svg>
{% endif %}
  </div>

  <div class="p-5 flex flex-col gap-3 flex-grow">
    <a href="/media/{{ p.path }}" target="_blank"
       class="card-title text-xl font-extrabold text-gray-900 leading-snug hover:text-blue-600 transition line-clamp-2"
       title="{{ p.title }}">{{ p.title }}</a>

    <div class="flex items-center gap-2 text-xs font-medium">
      <span class="year-badge inline-flex items-center gap-1 rounded-full bg-blue-100 text-blue-700 px-3 py-1 shadow-sm">
        {{ p.year or 'â€”' }}
      </span>
      <span class="src-badge inline-flex items-center gap-1 rounded-full bg-gray-100 text-gray-600 px-3 py-1 shadow-sm">
        {{ (p.abstract_source or 'Auto') | title }}
      </span>
    </div>

    {% if p.authors_json %}
      <div class="card-authors text-sm text-gray-600 line-clamp-1">
        **Authors:** {{ p.authors_json }}
      </div>
    {% endif %}

    {% if p.abstract %}
      <div x-data="{ expanded: false }" class="relative mt-2">
        <div x-show="!expanded" x-cloak class="card-abstract text-sm text-gray-700 leading-relaxed line-clamp-3">{{ p.abstract }}</div>
        <div x-show="!expanded" x-cloak class="pointer-events-none absolute bottom-8 left-0 right-0 h-8 bg-gradient-to-t from-white to-transparent"></div>
        <div x-show="expanded" x-cloak class="card-abstract text-sm text-gray-700 leading-relaxed">{{ p.abstract }}</div>

        {% if p.abstract|length > 200 %}
          <button @click="expanded = !expanded"
                  class="mt-2 inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 text-sm font-semibold transition">
            <svg x-show="!expanded" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-blue-500"><path fill-rule="evenodd" d="M10 3a1 1 0 01.894.553l5 10A1 1 0 0115 15H5a1 1 0 01-.894-1.447l5-10A1 1 0 0110 3zm0 4a1 1 0 00-.894.553L7.618 9h4.764l-1.488-1.447A1 1 0 0010 7z" clip-rule="evenodd"/></svg>
            <svg x-show="expanded" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-blue-500"><path fill-rule="evenodd" d="M10 17a1 1 0 01-.894-.553l-5-10A1 1 0 015 5h10a1 1 0 01.894 1.447l-5 10A1 1 0 0110 17zm0-4a1 1 0 00.894-.553L12.382 11H7.618l1.488 1.447A1 1 0 0010 13z" clip-rule="evenodd"/></svg>
            <span x-show="!expanded">Read full abstract</span>
            <span x-show="expanded">Show less</span>
          </button>
        {% endif %}
      </div>
    {% else %}
      <div class="card-abstract text-sm italic text-gray-400 py-1">No abstract detected.</div>
    {% endif %}
  </div>
</div>