<div
  class="rounded-2xl shadow-sm hover:shadow-lg overflow-hidden flex flex-col h-auto border transition duration-150 ease-out
         bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700 text-slate-900 dark:text-slate-100"
  data-paper-card
  onmouseenter="this.style.transform='translateY(-1px)';"
  onmouseleave="this.style.transform='none';"
>
  <!-- Thumbnail -->
  <div
    class="flex items-center justify-center overflow-hidden border-b border-gray-200 dark:border-slate-700 bg-gradient-to-b from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800"
    style="height:40%;min-height:120px;"
  >
    {% if paper.thumb_path %}
      <img
        src="/media/{{ paper.thumb_path }}"
        alt="{{ paper.title }}"
        loading="lazy"
        class="w-full h-full object-cover"
      />
    {% else %}
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
           class="w-16 h-16 text-slate-400 dark:text-slate-500 opacity-40">
        <path fill="currentColor" d="M6 2h7l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm7 1.5V8h4.5L13 3.5z"/>
      </svg>
    {% endif %}
  </div>

  <!-- Card Body -->
  <div class="flex flex-col flex-1 p-4 gap-2">
    <!-- Title -->
    <h3 class="text-base font-bold leading-snug m-0">
      <a href="{{ paper.url or ('/media/' + paper.path) }}" target="_blank"
         class="text-slate-900 dark:text-slate-50 hover:text-blue-600 dark:hover:text-blue-300 transition line-clamp-2">
        {{ paper.title }}
      </a>
    </h3>

    <!-- Authors -->
    <div class="mt-1 text-sm flex items-center gap-2 text-slate-600 dark:text-slate-200">
      <div class="min-w-0 flex-1 overflow-hidden">
        {% set authors = paper.authors or [] %}
        {% if authors|length > 0 %}
          <span title="{{ authors|join(', ') }}">{{ authors|join(', ') }}</span>
        {% else %}
          <span class="opacity-70">Unknown author</span>
        {% endif %}
      </div>
    </div>

    <!-- Year / Venue / Source -->
    <div class="flex flex-wrap gap-2 mt-2 text-xs">
      {% if paper.venue %}
        <span class="inline-flex items-center rounded-full px-3 py-1 font-medium
                     bg-slate-100 text-slate-700 dark:bg-slate-600/40 dark:text-slate-100 dark:ring-1 dark:ring-slate-500/40">
          {{ paper.venue }}
        </span>
      {% endif %}
      {% if paper.year %}
        <span class="inline-flex items-center rounded-full px-2.5 py-0.5 font-semibold
                     bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-200 dark:ring-1 dark:ring-indigo-400/30">
          {{ paper.year }}
        </span>
      {% endif %}
      {% if paper.data_src %}
        <span class="inline-flex items-center rounded-full px-3 py-1 font-semibold
                     bg-indigo-100 text-indigo-700 dark:bg-sky-500/20 dark:text-sky-200 dark:ring-1 dark:ring-sky-400/30">
          {{ paper.data_src | title }}
        </span>
      {% endif %}
    </div>

    <!-- Abstract -->
    {% if paper.abstract %}
      <div class="mt-3 text-[0.95rem] leading-relaxed text-slate-700 dark:text-slate-200" data-abstract>
        <p data-short class="line-clamp-3">
          {{ paper.abstract }}
        </p>
        <p data-full class="hidden max-h-0 overflow-hidden transition-all duration-300 ease-in-out">
          {{ paper.abstract }}
        </p>
        <button
          type="button"
          data-toggle
          aria-expanded="false"
          class="mt-1 text-sm font-medium underline text-blue-600 hover:text-blue-700 dark:text-blue-300 dark:hover:text-blue-200"
        >
          Read more
        </button>
      </div>
    {% endif %}

    <!-- Actions -->
    <div class="mt-auto flex items-center justify-end gap-2">
      <a href="{{ paper.url or ('/media/' + paper.path) }}" target="_blank"
         class="inline-flex items-center px-3.5 py-2 rounded-xl text-white text-sm font-semibold shadow-sm
                bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500
                dark:bg-blue-500 dark:hover:bg-blue-400">
        Open
      </a>
      <a href="/media/{{ paper.path }}" download
         class="inline-flex items-center px-3.5 py-2 rounded-xl text-sm font-semibold border
                bg-white text-slate-800 hover:bg-slate-50
                dark:bg-slate-800 dark:text-slate-100 dark:border-slate-600 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        Download
      </a>
    </div>
  </div>
</div>

<!-- Inline JS -->
<script>
(function () {
  function initOne(container) {
    if (!container || container.__abstractInit) return;
    container.__abstractInit = true;

    const shortEl = container.querySelector('[data-short]');
    const fullEl  = container.querySelector('[data-full]');
    const btn     = container.querySelector('[data-toggle]');
    if (!shortEl || !fullEl || !btn) return;

    btn.addEventListener('click', () => {
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      if (expanded) {
        // Collapse
        fullEl.classList.add('max-h-0', 'opacity-0');
        fullEl.classList.remove('max-h-[500px]', 'opacity-100');
        setTimeout(() => {
          fullEl.classList.add('hidden');
          shortEl.classList.remove('hidden');
        }, 200);
        btn.textContent = 'Read more';
        btn.setAttribute('aria-expanded', 'false');
      } else {
        // Expand
        shortEl.classList.add('hidden');
        fullEl.classList.remove('hidden');
        setTimeout(() => {
          fullEl.classList.add('max-h-[500px]', 'opacity-100');
          fullEl.classList.remove('max-h-0', 'opacity-0');
        }, 10);
        btn.textContent = 'Show less';
        btn.setAttribute('aria-expanded', 'true');
      }
    });
  }

  function initAll(root) {
    (root || document).querySelectorAll('[data-abstract]').forEach(initOne);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => initAll(document));
  } else {
    initAll(document);
  }

  new MutationObserver(mutations => {
    mutations.forEach(m => {
      m.addedNodes.forEach(node => {
        if (!(node instanceof Element)) return;
        if (node.matches?.('[data-abstract]')) initOne(node);
        node.querySelectorAll?.('[data-abstract]').forEach(initOne);
      });
    });
  }).observe(document.body, { childList: true, subtree: true });
})();
</script>