<!-- Single card (structure reused on client by cloning a hidden copy) -->
<div class="group bg-white rounded-xl border shadow-sm hover:shadow-md transition overflow-hidden flex flex-col">
  <!-- Thumbnail / Header -->
  <div class="relative h-48 bg-gray-100 flex items-center justify-center overflow-hidden">
    {% if p.thumb_path %}
  <img src="/media/{{ p.thumb_path }}" alt="Thumbnail for {{ p.title }}"
       class="thumb-img w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.02]" />
{% else %}
  <!-- Inline SVG placeholder: no network request, never 404 -->
  <svg class="w-full h-full text-gray-300" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="No thumbnail">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="currentColor" stop-opacity="0.25"/>
        <stop offset="100%" stop-color="currentColor" stop-opacity="0.10"/>
      </linearGradient>
    </defs>
    <rect width="400" height="300" fill="url(#g)"/>
    <g fill="currentColor" opacity="0.5">
      <rect x="40" y="40" width="320" height="200" rx="8" ry="8" fill="currentColor" opacity="0.12"/>
      <circle cx="200" cy="140" r="42"/>
      <rect x="120" y="220" width="160" height="12" rx="6" opacity="0.5"/>
    </g>
  </svg>
{% endif %}
    <!-- Quick open chip (top-right) -->
    <a href="/media/{{ p.path }}" target="_blank"
       class="chip-open absolute top-2 right-2 inline-flex items-center gap-1 rounded-full bg-white/90 backdrop-blur px-3 py-1 text-xs font-medium text-blue-700 hover:bg-white shadow">
      <!-- PDF icon (inline SVG) -->
      <svg viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM8 14h1.5a1.5 1.5 0 0 0 0-3H8v3zm4 0h.75A1.25 1.25 0 1 0 12.75 11H12v3zm3 .75a.75.75 0 0 1-.75.75H14v-5h1.25a.75.75 0 0 1 0 1.5H15v1h.25a.75.75 0 0 1 .75.75v1zM13 4.5V9h4.5"/>
      </svg>
      Open
    </a>
  </div>

  <!-- Body -->
  <div class="p-4 flex flex-col gap-2">
    <!-- Title -->
    <a href="/media/{{ p.path }}" target="_blank"
       class="card-title font-semibold text-gray-900 leading-snug hover:underline line-clamp-2"
       title="{{ p.title }}">{{ p.title }}</a>

    <!-- Meta row -->
    <div class="flex items-center gap-2 text-xs text-gray-600">
      <span class="year-badge inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-0.5">
        {{ p.year or 'â€”' }}
      </span>
      <span class="src-badge inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-0.5">
        {{ (p.abstract_source or 'Auto') | title }}
      </span>
    </div>

    <!-- Authors -->
<!--    {% if p.authors_json %}-->
<!--      <span class="inline-flex items-center gap-1 bg-gray-100 text-gray-700 text-xs px-2 py-0.5 rounded-full">-->
<!--              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3 text-gray-500">-->
<!--                <path fill-rule="evenodd" d="M10 2a4 4 0 100 8 4 4 0 000-8zm-7 14a7 7 0 1114 0H3z" clip-rule="evenodd" />-->
<!--              </svg>-->
<!--              {{ p.authors_json }}-->
<!--            </span>-->
<!--    {% endif %}-->

    <!-- Abstract with gradient fade + expand -->
    {% if p.abstract %}
      <div x-data="{ expanded: false }" class="relative">
        <!-- Collapsed -->
        <div x-show="!expanded" x-cloak class="card-abstract text-sm text-gray-700 leading-relaxed line-clamp-3">{{ p.abstract }}</div>
        <div x-show="!expanded" x-cloak class="pointer-events-none absolute bottom-8 left-0 right-0 h-8 bg-gradient-to-t from-white to-transparent"></div>
        <!-- Expanded -->
        <div x-show="expanded" x-cloak class="card-abstract text-sm text-gray-700 leading-relaxed">{{ p.abstract }}</div>

        {% if p.abstract|length > 200 %}
          <button @click="expanded = !expanded"
                  class="mt-2 inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 text-xs font-medium">
            <svg x-show="!expanded" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M10 3a1 1 0 01.894.553l5 10A1 1 0 0115 15H5a1 1 0 01-.894-1.447l5-10A1 1 0 0110 3zm0 4a1 1 0 00-.894.553L7.618 9h4.764l-1.488-1.447A1 1 0 0010 7z" clip-rule="evenodd"/></svg>
            <svg x-show="expanded" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M10 17a1 1 0 01-.894-.553l-5-10A1 1 0 015 5h10a1 1 0 01.894 1.447l-5 10A1 1 0 0110 17zm0-4a1 1 0 00.894-.553L12.382 11H7.618l1.488 1.447A1 1 0 0010 13z" clip-rule="evenodd"/></svg>
            <span x-show="!expanded">Read more</span>
            <span x-show="expanded">Show less</span>
          </button>
        {% endif %}
      </div>
    {% else %}
      <div class="card-abstract text-sm italic text-gray-400">No abstract detected.</div>
    {% endif %}
  </div>

  <!-- Footer / right-aligned Open -->
  <div class="px-4 pb-4 mt-auto flex justify-end">
    <a href="/media/{{ p.path }}" target="_blank"
       class="card-open inline-flex items-center gap-2 text-sm font-medium text-blue-700 hover:text-blue-900 hover:underline">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-blue-700">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM8 14h1.5a1.5 1.5 0 0 0 0-3H8v3zm4 0h.75A1.25 1.25 0 1 0 12.75 11H12v3zm3 .75a.75.75 0 0 1-.75.75H14v-5h1.25a.75.75 0 0 1 0 1.5H15v1h.25a.75.75 0 0 1 .75.75v1zM13 4.5V9h4.5"/>
      </svg>
      <span>Open PDF</span>
    </a>
  </div>
</div>