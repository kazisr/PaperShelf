{% extends "base.html" %}
{% block content %}

<!-- Search and Folder Upload -->
<div class="bg-white dark:bg-slate-900 p-4 rounded-2xl shadow-lg mb-6 border border-gray-100 dark:border-slate-700">
  <form method="get" class="flex items-center gap-3">
    <!-- Search Input -->
    <div class="relative flex-1">
      <svg class="w-5 h-5 text-gray-400 dark:text-slate-400 absolute left-3 top-1/2 transform -translate-y-1/2"
           xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <input
        name="q"
        value="{{ q }}"
        placeholder="Search papers..."
        class="w-full border border-gray-300 dark:border-slate-600 rounded-xl pl-10 pr-3 py-2 text-gray-700 dark:text-slate-100 dark:bg-slate-800 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
        oninput="liveSearch(this.value)"
      />
    </div>

    <!-- Folder Select Icon Button -->
    <label class="flex items-center justify-center w-10 h-10 rounded-xl bg-blue-600 hover:bg-blue-700 text-white shadow-md cursor-pointer transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7h4l2 3h10a1 1 0 011 1v7a1 1 0 01-1 1H3V7z" />
      </svg>
      <input id="folderPicker" type="file" webkitdirectory directory multiple hidden />
    </label>

    <!-- Clean DB Icon Button -->
    <form method="post" action="/dev/clean" class="shrink-0">
      <button class="flex items-center justify-center w-10 h-10 rounded-xl border border-red-500 text-red-600 hover:bg-red-50 dark:hover:bg-red-950 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-3h4m-5 3h6" />
        </svg>
      </button>
    </form>
  </form>
</div>

<!-- Carousel for Papers -->
{% if papers %}
<div id="paperCarousel" class="relative w-full mt-6" data-carousel='{ "loadingClasses": "opacity-0", "slidesQty": { "xs": 1, "lg": 3 }, "isCentered": true, "isSnap": true }'>
  <div class="carousel h-auto flex overflow-x-auto snap-x snap-mandatory scroll-smooth space-x-4 pb-3">
    <div class="carousel-body flex h-full gap-4 opacity-0 animate-fade-in">
      {% for paper in papers %}
      <div class="carousel-slide snap-center shrink-0 w-80">
        {% set paper = paper %}
        {% include "_paper_card.html" %}
      </div>
      {% endfor %}
    </div>
  </div>


</div>
{% else %}
<div id="drop" x-data
     @dragover.prevent.delay.100="$el.classList.add('bg-blue-50', 'border-blue-500')"
     @dragleave.prevent.delay.100="$el.classList.remove('bg-blue-50', 'border-blue-500')"
     @drop.prevent="
       $el.classList.remove('bg-blue-50', 'border-blue-500');
       const files = $event.dataTransfer.files;
       for (const f of files) {
         if (!f.name.toLowerCase().endsWith('.pdf')) continue;
         const fd = new FormData();
         fd.append('file', f);
         fetch('/upload', { method:'POST', body:fd }).then(() => refreshCards());
       }
     "
     class="col-span-full mb-6 p-6 text-center border-4 border-dashed rounded-2xl border-gray-300 bg-gray-50 dark:bg-slate-800 dark:border-slate-700 text-lg text-gray-500 dark:text-slate-400 transition duration-200 ease-in-out">
  Drag & drop <b>PDF(s)</b> here to add ðŸ“¥
</div>
{% endif %}

<style>
@keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
.animate-fade-in { animation: fade-in 0.6s ease-out forwards; }
</style>

{% endblock %}